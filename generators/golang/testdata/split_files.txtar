Test split-files mode: types go to protocol.go, interfaces to server.go/client.go,
union types with JSON to json.go.

Flags: server, client, split-files

-- input.json --
{
  "metaData": {"version": "3.17.0"},
  "requests": [
    {
      "method": "textDocument/hover",
      "documentation": "Request to resolve a hover.",
      "messageDirection": "clientToServer",
      "params": {"kind": "reference", "name": "HoverParams"},
      "result": {"kind": "reference", "name": "Hover"}
    }
  ],
  "notifications": [
    {
      "method": "window/showMessage",
      "documentation": "Show message notification.",
      "messageDirection": "serverToClient",
      "params": {"kind": "reference", "name": "ShowMessageParams"}
    }
  ],
  "structures": [
    {
      "name": "HoverParams",
      "properties": [
        {
          "name": "position",
          "type": {"kind": "reference", "name": "Position"}
        }
      ]
    },
    {
      "name": "Hover",
      "properties": [
        {
          "name": "contents",
          "type": {
            "kind": "or",
            "items": [
              {"kind": "base", "name": "string"},
              {"kind": "reference", "name": "MarkedString"}
            ]
          }
        }
      ]
    },
    {
      "name": "MarkedString",
      "properties": [
        {
          "name": "language",
          "type": {"kind": "base", "name": "string"}
        }
      ]
    },
    {
      "name": "ShowMessageParams",
      "properties": [
        {
          "name": "message",
          "type": {"kind": "base", "name": "string"}
        }
      ]
    },
    {
      "name": "Position",
      "properties": [
        {
          "name": "line",
          "type": {"kind": "base", "name": "uinteger"}
        }
      ]
    }
  ],
  "enumerations": [],
  "typeAliases": []
}
-- want/protocol.go --
// Code generated by lspls. DO NOT EDIT.
package protocol

import "encoding/json"

var _ = json.RawMessage{} // suppress unused import

type Hover struct {
	Contents Or_MarkedString_string `json:"contents"`
}

type HoverParams struct {
	Position Position `json:"position"`
}

type MarkedString struct {
	Language string `json:"language"`
}

type Position struct {
	Line uint32 `json:"line"`
}

type ShowMessageParams struct {
	Message string `json:"message"`
}

-- want/server.go --
// Code generated by lspls. DO NOT EDIT.
package protocol

import "context"

// LSP method names.
const (
	MethodTextDocumentHover = "textDocument/hover"
	MethodWindowShowMessage = "window/showMessage"
)

// Server defines the LSP server interface.
type Server interface {
	// Request to resolve a hover.
	TextDocumentHover(context.Context, *HoverParams) (*Hover, error)
}

-- want/client.go --
// Code generated by lspls. DO NOT EDIT.
package protocol

import "context"

// LSP method names.
const (
	MethodTextDocumentHover = "textDocument/hover"
	MethodWindowShowMessage = "window/showMessage"
)

// Client defines the LSP client interface.
type Client interface {
	// Show message notification.
	WindowShowMessage(context.Context, *ShowMessageParams) error
}

-- want/json.go --
// Code generated by lspls. DO NOT EDIT.
package protocol

import (
	"encoding/json"
	"fmt"
)

// Or_MarkedString_string is a union type for: MarkedString | string
type Or_MarkedString_string struct {
	Value any `json:"value"`
}

func (t Or_MarkedString_string) MarshalJSON() ([]byte, error) {
	switch x := t.Value.(type) {
	case MarkedString:
		return json.Marshal(x)
	case string:
		return json.Marshal(x)
	case nil:
		return []byte("null"), nil
	}
	return nil, fmt.Errorf("type %T not one of [MarkedString string]", t.Value)
}

func (t *Or_MarkedString_string) UnmarshalJSON(x []byte) error {
	if string(x) == "null" {
		t.Value = nil
		return nil
	}
	var h0 MarkedString
	if err := json.Unmarshal(x, &h0); err == nil {
		t.Value = h0
		return nil
	}
	var h1 string
	if err := json.Unmarshal(x, &h1); err == nil {
		t.Value = h1
		return nil
	}
	return fmt.Errorf("unmarshal failed to match one of [MarkedString string]")
}
