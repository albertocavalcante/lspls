# lspls

[![CI](https://github.com/albertocavalcante/lspls/actions/workflows/ci.yml/badge.svg)](https://github.com/albertocavalcante/lspls/actions/workflows/ci.yml)
[![Go Report Card](https://goreportcard.com/badge/github.com/albertocavalcante/lspls)](https://goreportcard.com/report/github.com/albertocavalcante/lspls)
[![Go Reference](https://pkg.go.dev/badge/github.com/albertocavalcante/lspls.svg)](https://pkg.go.dev/github.com/albertocavalcante/lspls)
[![License: MIT AND BSD-3-Clause](https://img.shields.io/badge/License-MIT%20AND%20BSD--3--Clause-blue.svg)](LICENSE)

> **L**SP **P**rotocol **L**anguage **S**ervices - Generate Go types from the LSP specification

Generate Go structs, interfaces, and constants directly from the official [Language Server Protocol specification](https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/).

## Why?

The LSP specification is defined in TypeScript and published as `metaModel.json`. Many Go LSP implementations need these types, but:

- **[go.lsp.dev/protocol](https://github.com/go-language-server/protocol)** is stuck on LSP 3.15.3
  - [Issue #48](https://github.com/go-language-server/protocol/issues/48): "Is there a long term plan to continue to maintain this package?"
  - [PR #52](https://github.com/go-language-server/protocol/pull/52): Draft PR for 3.17 support has been open since 2023
  - Missing LSP 3.17+ features like InlayHints, semantic tokens improvements, etc.

- **[gopls](https://github.com/golang/tools/tree/master/gopls)** generates its own types, but they're in `internal/` and can't be imported

**lspls** solves this by generating types directly from the official specification - always up-to-date, no waiting for upstream.

## Installation

```bash
go install github.com/albertocavalcante/lspls/cmd/lspls@latest
```

Or download from [Releases](https://github.com/albertocavalcante/lspls/releases).

## Quick Start

```bash
# Generate all LSP types (downloads spec automatically)
lspls -o ./protocol/

# Generate specific types only
lspls -t InlayHint,InlayHintKind,Position,Range -o ./types.go

# Preview without writing (dry run)
lspls --dry-run
```

## Usage

```
lspls [flags]

Flags:
  -o string        Output directory or file (default: stdout)
  -v string        LSP version or git ref (default: release/protocol/3.17.6-next.14)
  -t string        Comma-separated types to generate (default: all)
  -p string        Go package name (default: protocol)
  --spec string    Path to local metaModel.json
  --repo string    Path to local vscode-languageserver-node clone
  --proposed       Include proposed/unstable features
  --dry-run        Print to stdout without writing files
  --verbose        Verbose output
  --version        Show version information
```

## Examples

### Generate all types

```bash
lspls -o ./protocol/
```

Creates `protocol/protocol.go` with all LSP types.

### Generate specific types

```bash
lspls -t InlayHint,InlayHintKind,InlayHintParams,Position,Range -o ./lsp_types.go
```

### Use specific LSP version

```bash
# Latest 3.17
lspls -v release/protocol/3.17.6-next.14 -o ./protocol/

# 3.18 (with proposed features)
lspls -v release/protocol/3.18.0 --proposed -o ./protocol/
```

### Use local specification

```bash
# From local metaModel.json
lspls --spec ./metaModel.json -o ./protocol/

# From local repo clone
lspls --repo /path/to/vscode-languageserver-node -o ./protocol/
```

## Generated Code

lspls generates clean, idiomatic Go code:

```go
// Code generated by lspls. DO NOT EDIT.
// Source: https://github.com/microsoft/vscode-languageserver-node@release/protocol/3.17.6-next.14
// LSP Version: 3.17.0

package protocol

// Inlay hint information.
//
// @since 3.17.0
type InlayHint struct {
    // The position of this hint.
    Position Position `json:"position"`
    // The label of this hint.
    Label []InlayHintLabelPart `json:"label"`
    // The kind of this hint.
    Kind InlayHintKind `json:"kind,omitempty"`
    // Optional text edits.
    TextEdits []TextEdit `json:"textEdits,omitempty"`
    // Render padding before the hint.
    PaddingLeft bool `json:"paddingLeft,omitempty"`
    // Render padding after the hint.
    PaddingRight bool `json:"paddingRight,omitempty"`
}

// Inlay hint kinds.
//
// @since 3.17.0
type InlayHintKind uint32

const (
    // An inlay hint that for a type annotation.
    InlayHintKindType InlayHintKind = 1
    // An inlay hint that is for a parameter.
    InlayHintKindParameter InlayHintKind = 2
)
```

## Supported LSP Versions

| Version | Git Ref                           | Status       |
| ------- | --------------------------------- | ------------ |
| 3.17.x  | `release/protocol/3.17.6-next.14` | ‚úÖ Default   |
| 3.18.x  | `release/protocol/3.18.0`         | ‚úÖ Supported |

## How It Works

1. **Fetches** `metaModel.json` from [microsoft/vscode-languageserver-node](https://github.com/microsoft/vscode-languageserver-node) using shallow clone
2. **Parses** the JSON specification into a typed model
3. **Generates** Go code with proper type mappings:
   - TypeScript interfaces ‚Üí Go structs
   - TypeScript unions (`A | B`) ‚Üí Go `any` with documentation
   - TypeScript `T | null` ‚Üí Go `*T` with `omitempty`
   - Enumerations ‚Üí Go `const` with typed values

## Development

```bash
# Clone
git clone https://github.com/albertocavalcante/lspls
cd lspls

# Build
go build ./cmd/lspls

# Test
go test -v ./...

# Run
./lspls --dry-run --verbose
```

## Contributing

Contributions welcome! Please:

1. Fork the repository
2. Create a feature branch
3. Add tests for new functionality
4. Submit a pull request

## Credits & References

### gopls Protocol Generator

This tool is derived from gopls's internal generator at commit [`7b3ed75de`](https://github.com/golang/tools/tree/7b3ed75de0778c292b3f55c661cce98ce6028f94/gopls/internal/protocol/generate) (v0.41.0+35, 2026-02-03).

Key files (pinned to the commit we based this on):

| File         | Source                                                                                                                                                   | GitHub Mirror                                                                                                                         | Purpose                                            |
| ------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------- |
| main.go      | [cs.opensource.google](https://cs.opensource.google/go/x/tools/+/7b3ed75de0778c292b3f55c661cce98ce6028f94:gopls/internal/protocol/generate/main.go)      | [github](https://github.com/golang/tools/blob/7b3ed75de0778c292b3f55c661cce98ce6028f94/gopls/internal/protocol/generate/main.go)      | Entry point, orchestration                         |
| types.go     | [cs.opensource.google](https://cs.opensource.google/go/x/tools/+/7b3ed75de0778c292b3f55c661cce98ce6028f94:gopls/internal/protocol/generate/types.go)     | [github](https://github.com/golang/tools/blob/7b3ed75de0778c292b3f55c661cce98ce6028f94/gopls/internal/protocol/generate/types.go)     | Model structs for metaModel.json                   |
| output.go    | [cs.opensource.google](https://cs.opensource.google/go/x/tools/+/7b3ed75de0778c292b3f55c661cce98ce6028f94:gopls/internal/protocol/generate/output.go)    | [github](https://github.com/golang/tools/blob/7b3ed75de0778c292b3f55c661cce98ce6028f94/gopls/internal/protocol/generate/output.go)    | **Code generation** - union types, JSON marshaling |
| typenames.go | [cs.opensource.google](https://cs.opensource.google/go/x/tools/+/7b3ed75de0778c292b3f55c661cce98ce6028f94:gopls/internal/protocol/generate/typenames.go) | [github](https://github.com/golang/tools/blob/7b3ed75de0778c292b3f55c661cce98ce6028f94/gopls/internal/protocol/generate/typenames.go) | Anonymous type naming                              |
| README.md    | [cs.opensource.google](https://cs.opensource.google/go/x/tools/+/7b3ed75de0778c292b3f55c661cce98ce6028f94:gopls/internal/protocol/generate/README.md)    | [github](https://github.com/golang/tools/blob/7b3ed75de0778c292b3f55c661cce98ce6028f94/gopls/internal/protocol/generate/README.md)    | Excellent documentation                            |

### LSP Specification

- [metaModel.json](https://github.com/microsoft/vscode-languageserver-node/blob/main/protocol/metaModel.json) - Official spec source
- [LSP 3.17 Spec](https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/) - Human-readable docs

## Ecosystem & Alternatives

This section documents the landscape of LSP type generation for Go, including why certain approaches work better than others. Useful context for contributors, users evaluating options, and future maintainers.

### The Problem

The LSP specification is defined in TypeScript and published as [`metaModel.json`](https://github.com/microsoft/vscode-languageserver-node/blob/main/protocol/metaModel.json). Go projects need these types, but TypeScript and Go have fundamentally different type systems:

| TypeScript       | Go               | Challenge                           |
| ---------------- | ---------------- | ----------------------------------- |
| `A \| B` (union) | No native unions | Need custom types + JSON marshaling |
| `T \| null`      | `*T`             | Must track optionality              |
| Interfaces       | Structs          | Structural vs nominal typing        |
| `any`            | `any` (1.18+)    | Type safety loss                    |

### Existing Go LSP Libraries

| Library                                                                               | Status          | Limitation                                                                                                                                                                                                |
| ------------------------------------------------------------------------------------- | --------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| [go.lsp.dev/protocol](https://github.com/go-language-server/protocol)                 | LSP 3.15.3      | Stuck since 2020. [Issue #48](https://github.com/go-language-server/protocol/issues/48) asks about maintenance; [PR #52](https://github.com/go-language-server/protocol/pull/52) for 3.17 is still draft. |
| [gopls internal](https://github.com/golang/tools/tree/master/gopls/internal/protocol) | LSP 3.17+       | Uses `internal/` package - can't import. Has gopls-specific customizations.                                                                                                                               |
| [sourcegraph/go-lsp](https://github.com/sourcegraph/go-lsp)                           | LSP 3.x partial | Manually maintained subset, incomplete.                                                                                                                                                                   |

**Why lspls?** Generate exactly the types you need, from any LSP version, with full control.

### TypeScript-to-Go Approaches

#### Microsoft's TypeScript-Go Port (Project Corsa)

Microsoft is porting the TypeScript compiler to Go ([typescript-go](https://github.com/microsoft/typescript-go)), targeting TypeScript 7.0 in early 2026. Key learnings from their approach:

- **Hybrid methodology**: Manual port of scanner/parser (~1.5 months), then automated tooling for the rest
- **Data structures by hand**: JS objects (flexible) vs Go structs (rigid memory layouts) required manual conversion
- **Internal tooling not public**: They built conversion tools but haven't released them
- **Why Go over Rust**: Idiomatic Go resembles their functional TS style; GC simplified porting vs Rust's memory management

Their LSP type generation (in `internal/lsp/lsproto/`) also parses `metaModel.json` directly - the same approach as lspls and gopls.

#### General TS‚ÜíGo Tools

| Tool                                                  | Type                  | Notes                                                                      |
| ----------------------------------------------------- | --------------------- | -------------------------------------------------------------------------- |
| [armsnyder/ts2go](https://github.com/armsnyder/ts2go) | Type definitions only | Converts TS interfaces to Go structs. Pre-v1.0, limited union support.     |
| [quicktype](https://github.com/glideapps/quicktype)   | Multi-language        | Generates from JSON/TS/GraphQL. General-purpose, may need post-processing. |
| [leona/ts2go](https://github.com/leona/ts2go)         | Full transpiler       | Experimental, "extremely limited subset" of TS.                            |

**Why these don't fully work for LSP:**

- Union types (`A | B`) need custom JSON marshaling - generic tools output `any`
- LSP has complex nested types, optional fields, and intersection types
- Generated code often needs manual refinement

#### The Right Approach: Parse metaModel.json

All mature LSP type generators (gopls, microsoft/typescript-go, lspls) parse `metaModel.json` directly rather than converting TypeScript source:

1. **Official source of truth**: Machine-readable, versioned, stable schema
2. **Avoids TS complexity**: No need to handle TS generics, mapped types, conditional types
3. **Full control**: Generate exactly the Go idioms you want

### Related Projects

| Project                                                                               | What it does                               |
| ------------------------------------------------------------------------------------- | ------------------------------------------ |
| [go.lsp.dev/protocol](https://github.com/go-language-server/protocol)                 | Go LSP types (stuck on 3.15.3)             |
| [gopls](https://github.com/golang/tools/tree/master/gopls)                            | Go language server with internal generator |
| [microsoft/typescript-go](https://github.com/microsoft/typescript-go)                 | TS compiler port to Go                     |
| [vscode-languageserver-node](https://github.com/microsoft/vscode-languageserver-node) | Official LSP spec source                   |

### Further Reading

**Microsoft TypeScript-Go Port (Project Corsa):**

- üìù [A 10x Faster TypeScript](https://devblogs.microsoft.com/typescript/typescript-native-port/) - Official announcement by Anders Hejlsberg (March 2025)
- üìù [Progress on TypeScript 7 - December 2025](https://devblogs.microsoft.com/typescript/progress-on-typescript-7-december-2025/) - Status update with benchmarks
- üìù [A closer look at the details behind the Go port](https://2ality.com/2025/03/typescript-in-go.html) - Deep dive by Dr. Axel Rauschmayer
- üìù [Why Go?](https://github.com/microsoft/typescript-go/discussions/411) - Official GitHub discussion on language choice
- üé• [TypeScript is being ported to Go](https://www.youtube.com/watch?v=10qowKUW82U) - Interview with Anders Hejlsberg (Michigan TypeScript)
- üé• [Anders Hejlsberg on TypeScript's Go Rewrite](https://www.youtube.com/watch?v=NrEW7F2WCNA) - Live interview by Matt Pocock
- üéß [TypeScript Just Got 10√ó Faster](https://syntax.fm/show/884/typescript-just-got-10x-faster) - Syntax podcast with Anders Hejlsberg & Daniel Rosenwasser

**TypeScript History:**

- üé• [TypeScript Origins: The Documentary](https://www.youtube.com/watch?v=U6s2pdxebSo) - 80 min documentary featuring Anders Hejlsberg, core team, and community (OfferZen, 2023)

**LSP Specification:**

- üìù [LSP 3.17 Specification](https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/) - Official human-readable docs
- üìù [metaModel.json](https://github.com/microsoft/vscode-languageserver-node/blob/main/protocol/metaModel.json) - Machine-readable spec source

## License

MIT AND BSD-3-Clause - See [LICENSE](LICENSE) and [NOTICE](NOTICE)

- Original code: MIT
- Code derived from golang.org/x/tools: BSD-3-Clause
