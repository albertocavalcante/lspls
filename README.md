# lspls

[![CI](https://github.com/albertocavalcante/lspls/actions/workflows/ci.yml/badge.svg)](https://github.com/albertocavalcante/lspls/actions/workflows/ci.yml)
[![Go Report Card](https://goreportcard.com/badge/github.com/albertocavalcante/lspls)](https://goreportcard.com/report/github.com/albertocavalcante/lspls)
[![Go Reference](https://pkg.go.dev/badge/github.com/albertocavalcante/lspls.svg)](https://pkg.go.dev/github.com/albertocavalcante/lspls)
[![License: MIT AND BSD-3-Clause](https://img.shields.io/badge/License-MIT%20AND%20BSD--3--Clause-blue.svg)](LICENSE)

Generate Go types, interfaces, and constants from the [Language Server Protocol specification](https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/).

## Why?

- **[go.lsp.dev/protocol](https://github.com/go-language-server/protocol)** is stuck on LSP 3.15.3 (missing InlayHints, semantic tokens, etc.)
- **[gopls](https://github.com/golang/tools/tree/master/gopls)** generates types but they're in `internal/` and can't be imported

**lspls** generates types directly from the official spec—always up-to-date, no waiting for upstream.

## Installation

```bash
go install github.com/albertocavalcante/lspls/cmd/lspls@latest
```

Or download from [Releases](https://github.com/albertocavalcante/lspls/releases).

## Quick Start

```bash
# Generate all LSP types
lspls -o ./protocol/

# Generate specific types only
lspls -t InlayHint,InlayHintKind,Position,Range -o ./types.go

# Preview without writing
lspls --dry-run
```

## Usage

```
lspls [flags]

Flags:
  -o string        Output directory or file (default: stdout)
  -v string        LSP version or git ref (default: release/protocol/3.17.6-next.14)
  -t string        Comma-separated types to generate (default: all)
  -p string        Go package name (default: protocol)
  --spec string    Path to local metaModel.json
  --repo string    Path to local vscode-languageserver-node clone
  --proposed       Include proposed/unstable features
  --dry-run        Print to stdout without writing files
  --verbose        Verbose output
  --version        Show version information
```

## Examples

### Generate all types

```bash
lspls -o ./protocol/
```

Creates `protocol/protocol.go` with all LSP types.

### Generate specific types

```bash
lspls -t InlayHint,InlayHintKind,InlayHintParams,Position,Range -o ./lsp_types.go
```

### Use specific LSP version

```bash
# Latest 3.17
lspls -v release/protocol/3.17.6-next.14 -o ./protocol/

# 3.18 (with proposed features)
lspls -v release/protocol/3.18.0 --proposed -o ./protocol/
```

### Use local specification

```bash
# From local metaModel.json
lspls --spec ./metaModel.json -o ./protocol/

# From local repo clone
lspls --repo /path/to/vscode-languageserver-node -o ./protocol/
```

## Generated Code

lspls generates idiomatic Go:

```go
// Code generated by lspls. DO NOT EDIT.
package protocol

import "context"

// LSP method names.
const (
    MethodInitialize        = "initialize"
    MethodTextDocumentHover = "textDocument/hover"
)

// Server defines the LSP server interface.
type Server interface {
    Initialize(context.Context, *InitializeParams) (*InitializeResult, error)
    TextDocumentHover(context.Context, *HoverParams) (*Hover, error)
}

// Client defines the LSP client interface.
type Client interface {
    WindowShowMessage(context.Context, *ShowMessageParams) error
}

// Inlay hint information.
// @since 3.17.0
type InlayHint struct {
    Position     Position             `json:"position"`
    Label        []InlayHintLabelPart `json:"label"`
    Kind         InlayHintKind        `json:"kind,omitempty"`
    TextEdits    []TextEdit           `json:"textEdits,omitempty"`
    PaddingLeft  bool                 `json:"paddingLeft,omitempty"`
    PaddingRight bool                 `json:"paddingRight,omitempty"`
}

type InlayHintKind uint32

const (
    InlayHintKindType      InlayHintKind = 1
    InlayHintKindParameter InlayHintKind = 2
)
```

## Features

- **Types**: Structs, enums, type aliases from LSP structures
- **Interfaces**: `Server` and `Client` interfaces from requests/notifications
- **Constants**: Method name constants (`MethodTextDocumentHover`, etc.)
- **Union types**: `Or_*` types with JSON marshal/unmarshal
- **Dependency resolution**: Automatically includes referenced types

## Type Mappings

| LSP (TypeScript)  | Go                          |
|-------------------|-----------------------------|
| `interface`       | `struct`                    |
| `A \| B` (union)  | `Or_A_B` with JSON methods  |
| `T \| null`       | `*T` with `omitempty`       |
| `enum`            | `type X int32/string`       |
| `integer`         | `int32`                     |
| `uinteger`        | `uint32`                    |
| `decimal`         | `float64`                   |
| `URI`             | `string`                    |

## Supported Versions

| Version | Git Ref                           | Status       |
|---------|-----------------------------------|--------------|
| 3.17.x  | `release/protocol/3.17.6-next.14` | Default      |
| 3.18.x  | `release/protocol/3.18.0`         | Supported    |

## Development

```bash
git clone https://github.com/albertocavalcante/lspls
cd lspls
go build ./cmd/lspls
go test ./...
```

## Credits

Code generation logic derived from [gopls](https://github.com/golang/tools/tree/master/gopls/internal/protocol/generate) (BSD-3-Clause).

For background on LSP type generation approaches and the Go LSP ecosystem, see [docs/ECOSYSTEM.md](docs/ECOSYSTEM.md).

## License

MIT AND BSD-3-Clause — See [LICENSE](LICENSE) and [NOTICE](NOTICE)
