# lspls

[![CI](https://github.com/albertocavalcante/lspls/actions/workflows/ci.yml/badge.svg)](https://github.com/albertocavalcante/lspls/actions/workflows/ci.yml)
[![Go Report Card](https://goreportcard.com/badge/github.com/albertocavalcante/lspls)](https://goreportcard.com/report/github.com/albertocavalcante/lspls)
[![Go Reference](https://pkg.go.dev/badge/github.com/albertocavalcante/lspls.svg)](https://pkg.go.dev/github.com/albertocavalcante/lspls)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

> **L**SP **P**rotocol **L**anguage **S**ervices - Generate Go types from the LSP specification

Generate Go structs, interfaces, and constants directly from the official [Language Server Protocol specification](https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/).

## Why?

The LSP specification is defined in TypeScript and published as `metaModel.json`. Many Go LSP implementations need these types, but:

- **[go.lsp.dev/protocol](https://github.com/go-language-server/protocol)** is stuck on LSP 3.15.3
  - [Issue #48](https://github.com/go-language-server/protocol/issues/48): "Is there a long term plan to continue to maintain this package?"
  - [PR #52](https://github.com/go-language-server/protocol/pull/52): Draft PR for 3.17 support has been open since 2023
  - Missing LSP 3.17+ features like InlayHints, semantic tokens improvements, etc.

- **[gopls](https://github.com/golang/tools/tree/master/gopls)** generates its own types, but they're in `internal/` and can't be imported

**lspls** solves this by generating types directly from the official specification - always up-to-date, no waiting for upstream.

## Installation

```bash
go install github.com/albertocavalcante/lspls/cmd/lspls@latest
```

Or download from [Releases](https://github.com/albertocavalcante/lspls/releases).

## Quick Start

```bash
# Generate all LSP types (downloads spec automatically)
lspls -o ./protocol/

# Generate specific types only
lspls -t InlayHint,InlayHintKind,Position,Range -o ./types.go

# Preview without writing (dry run)
lspls --dry-run
```

## Usage

```
lspls [flags]

Flags:
  -o string        Output directory or file (default: stdout)
  -v string        LSP version or git ref (default: release/protocol/3.17.6-next.14)
  -t string        Comma-separated types to generate (default: all)
  -p string        Go package name (default: protocol)
  --spec string    Path to local metaModel.json
  --repo string    Path to local vscode-languageserver-node clone
  --proposed       Include proposed/unstable features
  --dry-run        Print to stdout without writing files
  --verbose        Verbose output
  --version        Show version information
```

## Examples

### Generate all types

```bash
lspls -o ./protocol/
```

Creates `protocol/protocol.go` with all LSP types.

### Generate specific types

```bash
lspls -t InlayHint,InlayHintKind,InlayHintParams,Position,Range -o ./lsp_types.go
```

### Use specific LSP version

```bash
# Latest 3.17
lspls -v release/protocol/3.17.6-next.14 -o ./protocol/

# 3.18 (with proposed features)
lspls -v release/protocol/3.18.0 --proposed -o ./protocol/
```

### Use local specification

```bash
# From local metaModel.json
lspls --spec ./metaModel.json -o ./protocol/

# From local repo clone
lspls --repo /path/to/vscode-languageserver-node -o ./protocol/
```

## Generated Code

lspls generates clean, idiomatic Go code:

```go
// Code generated by lspls. DO NOT EDIT.
// Source: https://github.com/microsoft/vscode-languageserver-node@release/protocol/3.17.6-next.14
// LSP Version: 3.17.0

package protocol

// Inlay hint information.
//
// @since 3.17.0
type InlayHint struct {
    // The position of this hint.
    Position Position `json:"position"`
    // The label of this hint.
    Label []InlayHintLabelPart `json:"label"`
    // The kind of this hint.
    Kind InlayHintKind `json:"kind,omitempty"`
    // Optional text edits.
    TextEdits []TextEdit `json:"textEdits,omitempty"`
    // Render padding before the hint.
    PaddingLeft bool `json:"paddingLeft,omitempty"`
    // Render padding after the hint.
    PaddingRight bool `json:"paddingRight,omitempty"`
}

// Inlay hint kinds.
//
// @since 3.17.0
type InlayHintKind uint32

const (
    // An inlay hint that for a type annotation.
    InlayHintKindType InlayHintKind = 1
    // An inlay hint that is for a parameter.
    InlayHintKindParameter InlayHintKind = 2
)
```

## Supported LSP Versions

| Version | Git Ref | Status |
|---------|---------|--------|
| 3.17.x | `release/protocol/3.17.6-next.14` | ✅ Default |
| 3.18.x | `release/protocol/3.18.0` | ✅ Supported |

## How It Works

1. **Fetches** `metaModel.json` from [microsoft/vscode-languageserver-node](https://github.com/microsoft/vscode-languageserver-node) using shallow clone
2. **Parses** the JSON specification into a typed model
3. **Generates** Go code with proper type mappings:
   - TypeScript interfaces → Go structs
   - TypeScript unions (`A | B`) → Go `any` with documentation
   - TypeScript `T | null` → Go `*T` with `omitempty`
   - Enumerations → Go `const` with typed values

## Development

```bash
# Clone
git clone https://github.com/albertocavalcante/lspls
cd lspls

# Build
go build ./cmd/lspls

# Test
go test -v ./...

# Run
./lspls --dry-run --verbose
```

## Contributing

Contributions welcome! Please:

1. Fork the repository
2. Create a feature branch
3. Add tests for new functionality
4. Submit a pull request

## Credits & References

### gopls Protocol Generator

This tool is inspired by gopls's internal generator. Key files to reference:

| File | Purpose |
|------|---------|
| [main.go](https://github.com/golang/tools/blob/master/gopls/internal/protocol/generate/main.go) | Entry point, orchestration |
| [types.go](https://github.com/golang/tools/blob/master/gopls/internal/protocol/generate/types.go) | Model structs for metaModel.json |
| [output.go](https://github.com/golang/tools/blob/master/gopls/internal/protocol/generate/output.go) | **Code generation** - union type handling, JSON marshaling |
| [typenames.go](https://github.com/golang/tools/blob/master/gopls/internal/protocol/generate/typenames.go) | Anonymous type naming |
| [README.md](https://github.com/golang/tools/blob/master/gopls/internal/protocol/generate/README.md) | Excellent documentation |

### LSP Specification

- [metaModel.json](https://github.com/microsoft/vscode-languageserver-node/blob/main/protocol/metaModel.json) - Official spec source
- [LSP 3.17 Spec](https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/) - Human-readable docs

### Related Projects

- [go.lsp.dev/protocol](https://github.com/go-language-server/protocol) - Go LSP types (stuck on 3.15.3)
- [gopls](https://github.com/golang/tools/tree/master/gopls) - Go language server (internal generator)

## License

MIT - See [LICENSE](LICENSE)
